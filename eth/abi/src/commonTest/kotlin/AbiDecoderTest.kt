@file:OptIn(ExperimentalStdlibApi::class)

import kosh.eth.abi.Value
import kosh.eth.abi.abi
import kosh.eth.abi.coder.decode
import kotlinx.io.bytestring.hexToByteString
import kotlin.test.Test
import kotlin.test.assertEquals

class AbiDecoderTest {

    @Test
    fun `decode path g`() {
        val data = ("0000000000000000000000000000000000000000000000000000000000000040" +
                "0000000000000000000000000000000000000000000000000000000000000140" +
                "0000000000000000000000000000000000000000000000000000000000000002" +
                "0000000000000000000000000000000000000000000000000000000000000040" +
                "00000000000000000000000000000000000000000000000000000000000000a0" +
                "0000000000000000000000000000000000000000000000000000000000000002" +
                "0000000000000000000000000000000000000000000000000000000000000001" +
                "0000000000000000000000000000000000000000000000000000000000000002" +
                "0000000000000000000000000000000000000000000000000000000000000001" +
                "0000000000000000000000000000000000000000000000000000000000000003" +
                "0000000000000000000000000000000000000000000000000000000000000003" +
                "0000000000000000000000000000000000000000000000000000000000000060" +
                "00000000000000000000000000000000000000000000000000000000000000a0" +
                "00000000000000000000000000000000000000000000000000000000000000e0" +
                "0000000000000000000000000000000000000000000000000000000000000003" +
                "6f6e650000000000000000000000000000000000000000000000000000000000" +
                "0000000000000000000000000000000000000000000000000000000000000003" +
                "74776f0000000000000000000000000000000000000000000000000000000000" +
                "0000000000000000000000000000000000000000000000000000000000000005" +
                "7468726565000000000000000000000000000000000000000000000000000000").hexToByteString()

        assertEquals(
            expected = Value.tuple(
                "array1" to Value.array(
                    Value.array(
                        1uL.abi,
                        2uL.abi,
                    ),
                    Value.array(
                        3uL.abi,
                    ),
                ),
                "array2" to Value.array(
                    "one".abi,
                    "two".abi,
                    "three".abi,
                )
            ),
            actual = Abis.g.decode(data)
        )
        val g = Abis.G(data)
        assertEquals(
            expected = Value.array(
                Value.array(
                    1uL.abi,
                    2uL.abi,
                ),
                Value.array(
                    3uL.abi,
                ),
            ),
            actual = g.array1
        )
        assertEquals(
            expected = Value.array(
                "one".abi,
                "two".abi,
                "three".abi,
            ),
            actual = g.array2
        )
    }
}
